# -*- restclient -*-
:host = localhost
:port = 5001
:protocol = http

# GET "/"
GET :protocol://:host::port/

# GET simple person input form
GET :protocol://:host::port/simple-form
-> run-hook (restclient-set-var ":csrf"
  ((lambda (s)
    (with-temp-buffer
      (insert s)
      (goto-char (point-min))
      (if (re-search-forward
            ".*id=\"csrf_token\"[^>]*value=\"\\([^\"]+\\)\".*"
            nil
            t)
          (match-string 1)
          "no csrf token found")))
     (buffer-string)))
# fail to add new person, missing name
POST :protocol://:host::port/simple-form
Content-Type: application/x-www-form-urlencoded

csrf_token=:csrf&age=1&bio=the+goat
# add new person
POST :protocol://:host::port/simple-form
Content-Type: application/x-www-form-urlencoded

csrf_token=:csrf&name=Msomething&age=1&bio=the+goatest
